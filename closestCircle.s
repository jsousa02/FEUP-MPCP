.data
.global min
min: .double 10000

.text
.global closestCircle
.type closestCircle, "function"

closestCircle:	MOV		W9, 2 // MULTIPLICADOR PARA OBTER TAMANHO DO VETOR VP
				MUL		W10, W0, W9 // TAMANHO DO VETOR VP
				MOV 	W11, 3 // MULTIPLICADOR PARA OBTER TAMANHO DO VETOR VC
				MUL		W12, W2, W11 // TAMANHO DO VETOR VC
				MOV		X6, X3 // COPIA DO ENDEREÇO DO VETOR VC
				MOV		W17, W2 // NUMERO DE CIRCUNFERENCIAS

OUTER:			CBZ		W0, FIM
				LDR		S0, [X1], 4 // X DO PONTO
				LDR 	S1, [X1], 4 // Y DO PONTO
				FCVT	D2, S0 // CONVERTER DE FLOAT PARA DOUBLE
				FCVT	D3, S1 // CONVERTER DE FLOAT PARA DOUBLE
				SUB		W0, W0, 1
				MOV		X3, X6 // REPOR ENDEREÇO DO VETOR VC
				MOV		W14, 0 // INDICE DA CIRCUNFERENCIA
				MOV		W2, W17 // Nº DE CIRCUNFERENCIAS
				MOV		W15, 0 // CONTADOR DE INVALIDOS
				LDR		D11, min

INNER:			CBZ		W2, ALTERAR_VALOR
				LDR		D4, [X3], 8 // X DO CENTRO
				LDR		D5, [X3], 8 // Y DO CENTRO
				LDR		D6, [X3], 8 // RAIO
				FSUB	D9, D2, D4
				FSUB	D10, D3, D5
				FMUL	D9, D9, D9
				FMUL	D10, D10, D10
				FADD	D10, D10, D9
				FSQRT 	D10, D10
				FSUB	D10, D10, D6 // DISTANCIA
				FCMP	D10, 0.0
				B.LE	INVALIDO
				FCMP	D10, D11
				B.LE	MUDAR_MINIMO
				SUB		W2, W2, 1
				ADD		W14, W14, 1
				B		INNER

MUDAR_MINIMO:	FMOV	D11, D10
				MOV		W13, W14 // ARMAZENAR O INDICE DA CIRCUNFERENCIA
				ADD		W14, W14, 1 // SOMAR 1 AO INDICE DA CIRCUNFERENCIA
				SUB		W2, W2, 1
				B		INNER

INVALIDO:		SUB  	W2, W2, 1
				ADD		W14, W14, 1 // SOMAR 1 AO INDICE DA CIRCUNFERENCIA
				ADD		W15, W15, 1 // +1 INVALIDO
				B		INNER

ALTERAR_VALOR:	CMP		W15, W17
				B.EQ	OUTER
				STR		W13, [X4], 4
				B 		OUTER

FIM:			RET
